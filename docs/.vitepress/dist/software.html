<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RestFull сервіс для управління відкритими даними | Проєкт студентів ФІОТу</title>
    <meta name="description" content="Лабораторні">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/DB_Lab6/assets/style.BGBfDOiu.css" as="style">
    <link rel="preload stylesheet" href="/DB_Lab6/vp-icons.css" as="style">
    
    <script type="module" src="/DB_Lab6/assets/app.XGddoO5h.js"></script>
    <link rel="preload" href="/DB_Lab6/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/DB_Lab6/assets/chunks/theme.BOFARGXE.js">
    <link rel="modulepreload" href="/DB_Lab6/assets/chunks/framework.BitmDC1G.js">
    <link rel="modulepreload" href="/DB_Lab6/assets/software.md.C0kvMj6A.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8d3e66f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-aff08a50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-aff08a50>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8d3e66f data-v-64278d09><div class="VPNavBar" data-v-64278d09 data-v-2f9a91a8><div class="wrapper" data-v-2f9a91a8><div class="container" data-v-2f9a91a8><div class="title" data-v-2f9a91a8><div class="VPNavBarTitle has-sidebar" data-v-2f9a91a8 data-v-db1abf29><a class="title" href="/DB_Lab6/" data-v-db1abf29><!--[--><!--]--><!----><span data-v-db1abf29>Проєкт студентів ФІОТу</span><!--[--><!--]--></a></div></div><div class="content" data-v-2f9a91a8><div class="content-body" data-v-2f9a91a8><!--[--><!--]--><div class="VPNavBarSearch search" data-v-2f9a91a8><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2f9a91a8 data-v-94e0de4d><span id="main-nav-aria-label" class="visually-hidden" data-v-94e0de4d> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/DB_Lab6/authors.html" tabindex="0" data-v-94e0de4d data-v-b04b12fe><!--[--><span data-v-b04b12fe>Автори</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/DB_Lab6/vstup_1.html" tabindex="0" data-v-94e0de4d data-v-b04b12fe><!--[--><span data-v-b04b12fe>Вступ</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-2f9a91a8 data-v-e6826308><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-e6826308 data-v-77e720fe data-v-b5a0f3c5><span class="check" data-v-b5a0f3c5><span class="icon" data-v-b5a0f3c5><!--[--><span class="vpi-sun sun" data-v-77e720fe></span><span class="vpi-moon moon" data-v-77e720fe></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2f9a91a8 data-v-cb473b7f data-v-e0cde419><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nexus-ct/DB_Lab6.git" aria-label="github" target="_blank" rel="noopener" data-v-e0cde419 data-v-6b91c750><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2f9a91a8 data-v-c4883afd data-v-3980e32a><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3980e32a><span class="vpi-more-horizontal icon" data-v-3980e32a></span></button><div class="menu" data-v-3980e32a><div class="VPMenu" data-v-3980e32a data-v-f8f1a359><!----><!--[--><!--[--><!----><div class="group" data-v-c4883afd><div class="item appearance" data-v-c4883afd><p class="label" data-v-c4883afd>Appearance</p><div class="appearance-action" data-v-c4883afd><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-c4883afd data-v-77e720fe data-v-b5a0f3c5><span class="check" data-v-b5a0f3c5><span class="icon" data-v-b5a0f3c5><!--[--><span class="vpi-sun sun" data-v-77e720fe></span><span class="vpi-moon moon" data-v-77e720fe></span><!--]--></span></span></button></div></div></div><div class="group" data-v-c4883afd><div class="item social-links" data-v-c4883afd><div class="VPSocialLinks social-links-list" data-v-c4883afd data-v-e0cde419><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nexus-ct/DB_Lab6.git" aria-label="github" target="_blank" rel="noopener" data-v-e0cde419 data-v-6b91c750><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2f9a91a8 data-v-6c970607><span class="container" data-v-6c970607><span class="top" data-v-6c970607></span><span class="middle" data-v-6c970607></span><span class="bottom" data-v-6c970607></span></span></button></div></div></div></div><div class="divider" data-v-2f9a91a8><div class="divider-line" data-v-2f9a91a8></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8d3e66f data-v-f3371c70><div class="container" data-v-f3371c70><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-f3371c70><span class="vpi-align-left menu-icon" data-v-f3371c70></span><span class="menu-text" data-v-f3371c70>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-f3371c70 data-v-1526310c><button data-v-1526310c>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8d3e66f data-v-77192a04><div class="curtain" data-v-77192a04></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-77192a04><span class="visually-hidden" id="sidebar-aria-label" data-v-77192a04> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-8e2b8225><section class="VPSidebarItem level-0 has-active" data-v-8e2b8225 data-v-8b85607e><!----><div class="items" data-v-8b85607e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Головна</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/authors.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Автори</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/vstup_1.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Вступ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/vstup.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Аналіз предметної області</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/zapity.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Запити зацікавлених осіб</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/lab2.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Модель прецедентів</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/lab3.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Проєктування інформаційного забезпечення: проєктування бази данних</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/lab5.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Реалізація інформаційного та програмного забезпечення</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/software.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>RestFull сервіс для управління відкритими даними</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-8b85607e data-v-8b85607e><div class="item" data-v-8b85607e><div class="indicator" data-v-8b85607e></div><a class="VPLink link link" href="/DB_Lab6/testing.html" data-v-8b85607e><!--[--><p class="text" data-v-8b85607e>Тестування працездатності системи</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8d3e66f data-v-6a411d75><div class="VPDoc has-sidebar has-aside" data-v-6a411d75 data-v-5e576dee><!--[--><!--]--><div class="container" data-v-5e576dee><div class="aside" data-v-5e576dee><div class="aside-curtain" data-v-5e576dee></div><div class="aside-container" data-v-5e576dee><div class="aside-content" data-v-5e576dee><div class="VPDocAside" data-v-5e576dee data-v-8e8afcfb><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-8e8afcfb data-v-f2249f6d><div class="content" data-v-f2249f6d><div class="outline-marker" data-v-f2249f6d></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f2249f6d>On this page</div><ul class="VPDocOutlineItem root" data-v-f2249f6d data-v-e7c3772a><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-8e8afcfb></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-5e576dee><div class="content-container" data-v-5e576dee><!--[--><!--]--><main class="main" data-v-5e576dee><div style="position:relative;" class="vp-doc _DB_Lab6_software" data-v-5e576dee><div><h1 id="restfull-сервіс-для-управління-відкритими-даними" tabindex="-1">RestFull сервіс для управління відкритими даними <a class="header-anchor" href="#restfull-сервіс-для-управління-відкритими-даними" aria-label="Permalink to &quot;RestFull сервіс для управління відкритими даними&quot;">​</a></h1><h2 id="цеи-restfull-сервіс-призначении-для-управління-відкритими-даними-в-базі-даних-postgresql-сервіс-розроблено-з-використанням-фреимворку-flask-на-мові-python-він-надає-можливість-реєстраціі-авторизаціі-користувачів-зміни-іх-прав-доступу-та-видалення-користувачів" tabindex="-1">Цей RestFull сервіс призначений для управління відкритими даними в базі даних PostgreSQL. Сервіс розроблено з використанням фреймворку Flask на мові Python. Він надає можливість реєстрації, авторизації користувачів, зміни їх прав доступу та видалення користувачів. <a class="header-anchor" href="#цеи-restfull-сервіс-призначении-для-управління-відкритими-даними-в-базі-даних-postgresql-сервіс-розроблено-з-використанням-фреимворку-flask-на-мові-python-він-надає-можливість-реєстраціі-авторизаціі-користувачів-зміни-іх-прав-доступу-та-видалення-користувачів" aria-label="Permalink to &quot;Цей RestFull сервіс призначений для управління відкритими даними в базі даних PostgreSQL. Сервіс розроблено з використанням фреймворку Flask на мові Python. Він надає можливість реєстрації, авторизації користувачів, зміни їх прав доступу та видалення користувачів.&quot;">​</a></h2><h3 id="_1-підключення-до-бази-даних" tabindex="-1">1. Підключення до бази даних <a class="header-anchor" href="#_1-підключення-до-бази-даних" aria-label="Permalink to &quot;1. Підключення до бази даних&quot;">​</a></h3><p>Для підключення до бази даних використовується бібліотека <code>psycopg2</code>. Нижче наведено приклад коду для підключення до бази даних PostgreSQL:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>import psycopg2</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Підключення до бази даних PostgreSQL</span></span>
<span class="line"><span>conn = psycopg2.connect(</span></span>
<span class="line"><span>    database=&quot;mydatabase&quot;,</span></span>
<span class="line"><span>    user=&quot;postgres&quot;,</span></span>
<span class="line"><span>    password=&quot;1234&quot;,</span></span>
<span class="line"><span>    host=&quot;localhost&quot;,</span></span>
<span class="line"><span>    port=&quot;5001&quot;</span></span>
<span class="line"><span>)</span></span></code></pre></div><h3 id="_2-модуль-для-отримання-даних-з-бази-даних" tabindex="-1">2. Модуль для отримання Даних з бази даних <a class="header-anchor" href="#_2-модуль-для-отримання-даних-з-бази-даних" aria-label="Permalink to &quot;2. Модуль для отримання Даних з бази даних&quot;">​</a></h3><p>Цей модуль відповідає за отримання даних з таблиці Users. Функція retrieve_users виконує SQL-запит для вибірки всіх даних з таблиці та повертає їх у вигляді словника.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>def retrieve_users(cursor):</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Отримання даних всіх користувачів з таблиці &quot;Users&quot;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Args:</span></span>
<span class="line"><span>        cursor: Курсор бази даних.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Returns:</span></span>
<span class="line"><span>        dict: Словник з даними користувачів.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    cursor.execute(&#39;&#39;&#39;SELECT * FROM &quot;Users&quot;&#39;&#39;&#39;)</span></span>
<span class="line"><span>    users_data = cursor.fetchall()</span></span>
<span class="line"><span>    cursor.close()</span></span>
<span class="line"><span>    return {&#39;data&#39;: users_data}</span></span></code></pre></div><h3 id="_3-модуль-для-реєстраціі-та-авторизаціі-користувачів" tabindex="-1">3. Модуль для реєстрації та авторизації користувачів <a class="header-anchor" href="#_3-модуль-для-реєстраціі-та-авторизаціі-користувачів" aria-label="Permalink to &quot;3. Модуль для реєстрації та авторизації користувачів&quot;">​</a></h3><p>Цей модуль містить функції для реєстрації нових користувачів, авторизації існуючих користувачів, зміни їх прав доступу та видалення користувачів.</p><ol><li>Функція register_user відповідає за реєстрацію нового користувача. Вона перевіряє, чи не існує вже користувач з вказаною електронною поштою, і, якщо ні, додає нового користувача до таблиці Users.</li><li>Функція authenticate_user відповідає за авторизацію користувача. Вона перевіряє, чи збігаються введені електронна пошта та пароль з даними в базі даних.</li><li>Функція update_user_role відповідає за зміну прав доступу користувача. Вона перевіряє, чи має адміністратор достатні права для зміни прав доступу іншого користувача.</li><li>Функція delete_user відповідає за видалення користувача з бази даних за електронною поштою.</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>from psycopg2 import errors</span></span>
<span class="line"><span>import db_connection</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def register_user(cursor, login, first_name, last_name, password, email, role_id):</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Реєстрація нового користувача в базі даних.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Args:</span></span>
<span class="line"><span>        cursor: Курсор бази даних.</span></span>
<span class="line"><span>        login (str): Логін користувача.</span></span>
<span class="line"><span>        first_name (str): Ім&#39;я користувача.</span></span>
<span class="line"><span>        last_name (str): Прізвище користувача.</span></span>
<span class="line"><span>        password (str): Пароль користувача.</span></span>
<span class="line"><span>        email (str): Електронна пошта користувача.</span></span>
<span class="line"><span>        role_id (int): Ідентифікатор ролі користувача.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Returns:</span></span>
<span class="line"><span>        str: Повідомлення про успішну реєстрацію або помилку.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    try:</span></span>
<span class="line"><span>        cursor.execute(&#39;SELECT email FROM &quot;Users&quot;&#39;)</span></span>
<span class="line"><span>        get_data = cursor.fetchall()</span></span>
<span class="line"><span>        for user in get_data:</span></span>
<span class="line"><span>            if email == user[0]:</span></span>
<span class="line"><span>                return {&#39;data&#39;: &quot;You already have an account&quot;}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        cursor.execute(&#39;SELECT MAX(id) FROM &quot;Users&quot;&#39;)</span></span>
<span class="line"><span>        next_id = cursor.fetchone()[0]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if next_id is None:</span></span>
<span class="line"><span>            next_id = 1</span></span>
<span class="line"><span>        else:</span></span>
<span class="line"><span>            next_id += 1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        insert_query = &#39;&#39;&#39;INSERT INTO &quot;Users&quot;(</span></span>
<span class="line"><span>            id, login, first_name, last_name, password, email, role_id)</span></span>
<span class="line"><span>            VALUES (%s, %s, %s, %s, %s, %s, %s)&#39;&#39;&#39;</span></span>
<span class="line"><span>        data = (next_id, login, first_name, last_name, password, email, role_id)</span></span>
<span class="line"><span>        cursor.execute(insert_query, data)</span></span>
<span class="line"><span>        cursor.connection.commit()</span></span>
<span class="line"><span>        return &quot;User registration successful!&quot;</span></span>
<span class="line"><span>    except (errors.InvalidTextRepresentation, ValueError, errors.InFailedSqlTransaction,</span></span>
<span class="line"><span>            errors.StringDataRightTruncation) as e:</span></span>
<span class="line"><span>        raise e</span></span>
<span class="line"><span>    finally:</span></span>
<span class="line"><span>        cursor.close()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def authenticate_user(cursor, password, email):</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>        Авторизація користувача.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        Args:</span></span>
<span class="line"><span>            cursor: Курсор бази даних.</span></span>
<span class="line"><span>            password (str): Пароль користувача.</span></span>
<span class="line"><span>            email (str): Електронна пошта користувача.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        Returns:</span></span>
<span class="line"><span>            str: Повідомлення про успішну авторизацію або помилку.</span></span>
<span class="line"><span>        &quot;&quot;&quot;</span></span>
<span class="line"><span>    try:</span></span>
<span class="line"><span>        cursor.execute(&#39;SELECT password, email FROM &quot;Users&quot; WHERE email = %s&#39;, (email,))</span></span>
<span class="line"><span>        user_data = cursor.fetchone()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if user_data is None:</span></span>
<span class="line"><span>            return &quot;User not found!&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if user_data[0] == password:</span></span>
<span class="line"><span>            return &quot;User login successful!&quot;</span></span>
<span class="line"><span>        else:</span></span>
<span class="line"><span>            return &quot;Password is wrong!&quot;</span></span>
<span class="line"><span>    except Exception as e:</span></span>
<span class="line"><span>        raise e</span></span>
<span class="line"><span>    finally:</span></span>
<span class="line"><span>        cursor.close()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def update_user_role(cursor, email, email_admin, password_admin, role_id):</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Зміна ролі користувача.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Args:</span></span>
<span class="line"><span>        cursor: Курсор бази даних.</span></span>
<span class="line"><span>        email (str): Електронна пошта користувача.</span></span>
<span class="line"><span>        email_admin (str): Електронна пошта адміністратора.</span></span>
<span class="line"><span>        password_admin (str): Пароль адміністратора.</span></span>
<span class="line"><span>        role_id (int): Новий ідентифікатор ролі користувача.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Returns:</span></span>
<span class="line"><span>        str: Повідомлення про успішну зміну ролі або помилку.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    try:</span></span>
<span class="line"><span>        with db_connection.conn.cursor() as admin_cursor:</span></span>
<span class="line"><span>            auth_result = authenticate_user(admin_cursor, password_admin, email_admin)</span></span>
<span class="line"><span>        if auth_result != &quot;User login successful!&quot;:</span></span>
<span class="line"><span>            return auth_result</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        cursor.execute(&#39;SELECT role_id FROM &quot;Users&quot; WHERE email = %s&#39;, (email_admin,))</span></span>
<span class="line"><span>        admin_data = cursor.fetchone()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if admin_data is None:</span></span>
<span class="line"><span>            return &quot;Admin not found!&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if admin_data[0] != 2:</span></span>
<span class="line"><span>            return &quot;You have no permission for that&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        cursor.execute(&#39;SELECT role_id FROM &quot;Users&quot; WHERE email = %s&#39;, (email,))</span></span>
<span class="line"><span>        user_data = cursor.fetchone()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if user_data is None:</span></span>
<span class="line"><span>            return &quot;User not found!&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if user_data[0] == role_id:</span></span>
<span class="line"><span>            return &quot;User already has this role!&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        cursor.execute(&#39;UPDATE &quot;Users&quot; SET role_id = %s WHERE email = %s&#39;, (role_id, email))</span></span>
<span class="line"><span>        cursor.connection.commit()</span></span>
<span class="line"><span>        return f&quot;You successfully updated role to {role_id}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    except Exception as e:</span></span>
<span class="line"><span>        raise e</span></span>
<span class="line"><span>    finally:</span></span>
<span class="line"><span>        cursor.close()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>def delete_user(cursor, email):</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Видалення користувача з бази даних за електронною поштою.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Args:</span></span>
<span class="line"><span>        cursor: Курсор бази даних.</span></span>
<span class="line"><span>        email (str): Електронна пошта користувача, якого потрібно видалити.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    Returns:</span></span>
<span class="line"><span>        str: Повідомлення про успішне видалення або помилку.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    try:</span></span>
<span class="line"><span>        cursor.execute(&#39;SELECT email FROM &quot;Users&quot; WHERE email = %s&#39;, (email,))</span></span>
<span class="line"><span>        user_data = cursor.fetchone()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        if user_data is None:</span></span>
<span class="line"><span>            return &quot;User not found!&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        cursor.execute(&#39;DELETE FROM &quot;Users&quot; WHERE email = %s&#39;, (email,))</span></span>
<span class="line"><span>        cursor.connection.commit()</span></span>
<span class="line"><span>        return &quot;User deleted successfully&quot;</span></span>
<span class="line"><span>    except Exception as e:</span></span>
<span class="line"><span>        raise e</span></span>
<span class="line"><span>    finally:</span></span>
<span class="line"><span>        cursor.close()</span></span></code></pre></div><h3 id="_4-rest-api-з-усіма-endpoint" tabindex="-1">4. REST API з усіма Endpoint <a class="header-anchor" href="#_4-rest-api-з-усіма-endpoint" aria-label="Permalink to &quot;4. REST API з усіма Endpoint&quot;">​</a></h3><p>Цей модуль містить всі необхідні endpoint для взаємодії з сервісом. Він використовує Flask для створення RestFull API.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>from flask import Flask, jsonify, request</span></span>
<span class="line"><span>from psycopg2 import errors</span></span>
<span class="line"><span></span></span>
<span class="line"><span>import db_connection</span></span>
<span class="line"><span>import db_reader</span></span>
<span class="line"><span>import db_writer</span></span>
<span class="line"><span></span></span>
<span class="line"><span># Ініціалізація Flask-додатку</span></span>
<span class="line"><span>app = Flask(__name__)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.route(&#39;/fetch_users&#39;, methods=[&#39;GET&#39;])</span></span>
<span class="line"><span>def fetch_users():</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Отримання даних всіх користувачів з бази даних.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    with db_connection.conn.cursor() as cursor:</span></span>
<span class="line"><span>        # Виклик функції для отримання даних користувачів</span></span>
<span class="line"><span>        data = db_reader.retrieve_users(cursor)</span></span>
<span class="line"><span>    return jsonify(data)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.route(&#39;/registration&#39;, methods=[&#39;POST&#39;])</span></span>
<span class="line"><span>def register_new_user():</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Реєстрація нового користувача.</span></span>
<span class="line"><span>    Отримує дані користувача з запиту та додає їх до бази даних.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    request_data = request.get_json()</span></span>
<span class="line"><span>    login = request_data.get(&#39;login&#39;)</span></span>
<span class="line"><span>    first_name = request_data.get(&#39;first_name&#39;)</span></span>
<span class="line"><span>    last_name = request_data.get(&#39;last_name&#39;)</span></span>
<span class="line"><span>    password = request_data.get(&#39;password&#39;)</span></span>
<span class="line"><span>    email = request_data.get(&#39;email&#39;)</span></span>
<span class="line"><span>    role_id = request_data.get(&#39;role_id&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Перевірка наявності всіх необхідних параметрів</span></span>
<span class="line"><span>    if login and first_name and last_name and password and email and role_id:</span></span>
<span class="line"><span>        try:</span></span>
<span class="line"><span>            with db_connection.conn.cursor() as cursor:</span></span>
<span class="line"><span>                # Виклик функції для реєстрації нового користувача</span></span>
<span class="line"><span>                data = db_writer.register_user(cursor, login, first_name, last_name, password, email, role_id)</span></span>
<span class="line"><span>            return jsonify(data)</span></span>
<span class="line"><span>        except (errors.InvalidTextRepresentation, ValueError, errors.InFailedSqlTransaction,</span></span>
<span class="line"><span>                errors.StringDataRightTruncation) as e:</span></span>
<span class="line"><span>            # Обробка помилок при реєстрації</span></span>
<span class="line"><span>            return jsonify({&#39;error&#39;: str(e)}), 400</span></span>
<span class="line"><span>        finally:</span></span>
<span class="line"><span>            db_connection.conn.rollback()</span></span>
<span class="line"><span>    else:</span></span>
<span class="line"><span>        return jsonify({&#39;error&#39;: &#39;Missing parameters&#39;}), 400</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.route(&#39;/login&#39;, methods=[&#39;POST&#39;])</span></span>
<span class="line"><span>def login_user():</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Авторизація користувача.</span></span>
<span class="line"><span>    Перевіряє введені користувачем дані для авторизації.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    request_data = request.get_json()</span></span>
<span class="line"><span>    password = request_data.get(&#39;password&#39;)</span></span>
<span class="line"><span>    email = request_data.get(&#39;email&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Перевірка наявності всіх необхідних параметрів</span></span>
<span class="line"><span>    if password and email:</span></span>
<span class="line"><span>        try:</span></span>
<span class="line"><span>            with db_connection.conn.cursor() as cursor:</span></span>
<span class="line"><span>                # Виклик функції для авторизації користувача</span></span>
<span class="line"><span>                data = db_writer.authenticate_user(cursor, password, email)</span></span>
<span class="line"><span>            return jsonify(data)</span></span>
<span class="line"><span>        except (errors.InvalidTextRepresentation, ValueError, errors.InFailedSqlTransaction,</span></span>
<span class="line"><span>                errors.StringDataRightTruncation) as e:</span></span>
<span class="line"><span>            # Обробка помилок при авторизації</span></span>
<span class="line"><span>            return jsonify({&#39;error&#39;: str(e)}), 400</span></span>
<span class="line"><span>        except TypeError:</span></span>
<span class="line"><span>            return jsonify({&quot;error&quot;: &quot;This user doesn&#39;t exist!&quot;})</span></span>
<span class="line"><span>        finally:</span></span>
<span class="line"><span>            db_connection.conn.rollback()</span></span>
<span class="line"><span>    else:</span></span>
<span class="line"><span>        return jsonify({&#39;error&#39;: &#39;Missing parameters&#39;}), 400</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.route(&#39;/change_permissions&#39;, methods=[&#39;POST&#39;])</span></span>
<span class="line"><span>def change_permissions():</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Зміна прав доступу користувача.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    request_data = request.get_json()</span></span>
<span class="line"><span>    role_id = request_data.get(&#39;role_id&#39;)</span></span>
<span class="line"><span>    email = request_data.get(&#39;email&#39;)</span></span>
<span class="line"><span>    email_admin = request_data.get(&#39;email_admin&#39;)</span></span>
<span class="line"><span>    password_admin = request_data.get(&#39;password_admin&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    # Перевірка наявності всіх необхідних параметрів</span></span>
<span class="line"><span>    if role_id and email and email_admin and password_admin:</span></span>
<span class="line"><span>        try:</span></span>
<span class="line"><span>            with db_connection.conn.cursor() as cursor:</span></span>
<span class="line"><span>                # Виклик функції для зміни прав доступу користувача</span></span>
<span class="line"><span>                data = db_writer.update_user_role(cursor, email, email_admin, password_admin, role_id)</span></span>
<span class="line"><span>            return jsonify(data)</span></span>
<span class="line"><span>        except (errors.InvalidTextRepresentation, ValueError, errors.InFailedSqlTransaction,</span></span>
<span class="line"><span>                errors.StringDataRightTruncation) as e:</span></span>
<span class="line"><span>            # Обробка помилок при зміні прав доступу</span></span>
<span class="line"><span>            return jsonify({&#39;error&#39;: str(e)}), 400</span></span>
<span class="line"><span>        except TypeError:</span></span>
<span class="line"><span>            return jsonify({&#39;error&#39;: &quot;This user doesn&#39;t exist! Change your email, or users&quot;})</span></span>
<span class="line"><span>        finally:</span></span>
<span class="line"><span>            db_connection.conn.rollback()</span></span>
<span class="line"><span>    else:</span></span>
<span class="line"><span>        return jsonify({&#39;error&#39;: &#39;Missing parameters&#39;}), 400</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@app.route(&#39;/delete&#39;, methods=[&#39;POST&#39;])</span></span>
<span class="line"><span>def delete_user():</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    Видалення користувача з бази даних за електронною поштою.</span></span>
<span class="line"><span>    &quot;&quot;&quot;</span></span>
<span class="line"><span>    request_data = request.get_json()</span></span>
<span class="line"><span>    email = request_data.get(&#39;email&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if email:</span></span>
<span class="line"><span>        try:</span></span>
<span class="line"><span>            with db_connection.conn.cursor() as cursor:</span></span>
<span class="line"><span>                # Виклик функції для видалення користувача</span></span>
<span class="line"><span>                data = db_writer.delete_user(cursor, email)</span></span>
<span class="line"><span>            return jsonify({&#39;message&#39;: data})</span></span>
<span class="line"><span>        except Exception as e:</span></span>
<span class="line"><span>            return jsonify({&#39;error&#39;: str(e)}), 400</span></span>
<span class="line"><span>    else:</span></span>
<span class="line"><span>        return jsonify({&#39;error&#39;: &#39;Missing email parameter&#39;}), 400</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if __name__ == &#39;__main__&#39;:</span></span>
<span class="line"><span>    # Запуск додатку на порту 5002</span></span>
<span class="line"><span>    app.run(port=5002)</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-5e576dee data-v-7ae10264><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-7ae10264><span class="visually-hidden" id="doc-footer-aria-label" data-v-7ae10264>Pager</span><div class="pager" data-v-7ae10264><a class="VPLink link pager-link prev" href="/DB_Lab6/lab5.html" data-v-7ae10264><!--[--><span class="desc" data-v-7ae10264>Previous page</span><span class="title" data-v-7ae10264>Реалізація інформаційного та програмного забезпечення</span><!--]--></a></div><div class="pager" data-v-7ae10264><a class="VPLink link pager-link next" href="/DB_Lab6/testing.html" data-v-7ae10264><!--[--><span class="desc" data-v-7ae10264>Next page</span><span class="title" data-v-7ae10264>Тестування працездатності системи</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"authors.md\":\"D6bA2saQ\",\"index.md\":\"C7F7rIv6\",\"lab2.md\":\"DnOBkepX\",\"lab3.md\":\"DAamAuNi\",\"lab5.md\":\"BXSyeBR1\",\"software.md\":\"C0kvMj6A\",\"testing.md\":\"nlNyANIf\",\"vstup.md\":\"DHickQR2\",\"vstup_1.md\":\"-A3f7j6Y\",\"zapity.md\":\"flztMubY\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Проєкт студентів ФІОТу\",\"description\":\"Лабораторні\",\"base\":\"/DB_Lab6/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Автори\",\"link\":\"/authors\"},{\"text\":\"Вступ\",\"link\":\"/vstup_1\"}],\"sidebar\":[{\"text\":\"Головна\",\"link\":\"/\"},{\"text\":\"Автори\",\"link\":\"/authors\"},{\"text\":\"Вступ\",\"link\":\"/vstup_1\"},{\"text\":\"Аналіз предметної області\",\"link\":\"/vstup\"},{\"text\":\"Запити зацікавлених осіб\",\"link\":\"/zapity\"},{\"text\":\"Модель прецедентів\",\"link\":\"/lab2\"},{\"text\":\"Проєктування інформаційного забезпечення: проєктування бази данних\",\"link\":\"/lab3\"},{\"text\":\"Реалізація інформаційного та програмного забезпечення\",\"link\":\"/lab5\"},{\"text\":\"RestFull сервіс для управління відкритими даними\",\"link\":\"/software\"},{\"text\":\"Тестування працездатності системи\",\"link\":\"/testing\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/nexus-ct/DB_Lab6.git\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>